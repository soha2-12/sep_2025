class Solution:
    def validateCoupons(self, code, businessLine, isActive):
        valid_lines = ["electronics", "grocery", "pharmacy", "restaurant"]
        order = {line: i for i, line in enumerate(valid_lines)}
        valid = []

        for i in range(len(code)):
            c = code[i]
            b = businessLine[i]

            # check active
            if not isActive[i]:
                continue

            # check business line
            if b not in order:
                continue

            # check code validity
            if not c:
                continue
            ok = True
            for ch in c:
                if not (ch.isalnum() or ch == "_"):
                    ok = False
                    break
            if not ok:
                continue

            valid.append((order[b], c))

        valid.sort()
        return [c for _, c in valid]
